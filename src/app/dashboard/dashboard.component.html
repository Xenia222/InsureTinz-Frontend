<app-navbar></app-navbar>
<div class="" style="padding: 0 0px !important;
overflow-x: hidden;">
    <div class="row">
        <app-sidebar style="padding-right: 0 !important;"></app-sidebar>

        <!-- Main content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 content">
            <div class="content">

                <!-- Sale & Revenue Start -->
                <div class="container-fluid pt-4 px-4 subc">
                    <div>
                        <h3 class="text-dark mb-3" style="font-weight: 500;">{{contents.dashboard[langue === 'fr' ? 'body_fr' : 'body_en']}}</h3>
                    </div>
                    <div class="row g-4">

                        <div *ngxPermissionsOnly="['client_view_balance']" class="col-sm-6 col-xl-3">
                            <div
                                class="bg-white d-flex align-items-center justify-content-between pt-2 pb-2 pl-3 pr-3 zone">

                                <div class=" ml-1 mt-1">
                                    <p class="mb-3" style="font-size: 14px; color: #202224;">Credits balance</p>
                                    <h3 class="mb-0" style="color: black; font-size: 2em;">{{ formatNumber(credit_balance.balance) }}</h3>
                                    <p class="mb-2 mt-4" style="font-size: 14px;">Since <span style="color: green;">{{ credit_balance.since }}</span></p>
                                </div>
                                <div class="ms-3 mb-auto">
                                    <p class="mb-2">
                                        <svg width="50" height="50" viewBox="0 0 60 60" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path opacity="0.21" fill-rule="evenodd" clip-rule="evenodd"
                                                d="M0 30V37C0 49.7025 10.2975 60 23 60H30H37C49.7025 60 60 49.7025 60 37V30V23C60 10.2975 49.7025 0 37 0H30H23C10.2975 0 0 10.2975 0 23V30Z"
                                                fill="#FEC53D" />
                                            <path fill-rule="evenodd" clip-rule="evenodd"
                                                d="M15 24.3167L27.9005 31.7648C28.0394 31.845 28.1851 31.9029 28.3333 31.9397V46.3849L15.9201 39.0387C15.3498 38.7012 15 38.0878 15 37.4251V24.3167ZM45 24.1187V37.4251C45 38.0878 44.6502 38.7012 44.0799 39.0387L31.6667 46.3849V31.8131C31.6969 31.798 31.7269 31.7819 31.7566 31.7648L45 24.1187Z"
                                                fill="#FEC53D" />
                                            <path opacity="0.499209" fill-rule="evenodd" clip-rule="evenodd"
                                                d="M15.4053 20.7014C15.5628 20.5024 15.7617 20.3343 15.9936 20.2108L29.1186 13.2201C29.6696 12.9266 30.3305 12.9266 30.8815 13.2201L44.0065 20.2108C44.1852 20.306 44.3444 20.4277 44.4801 20.5697L30.0899 28.8778C29.9953 28.9325 29.9081 28.995 29.8286 29.064C29.7491 28.995 29.6618 28.9325 29.5672 28.8778L15.4053 20.7014Z"
                                                fill="#FEC53D" />
                                        </svg>
                                    </p>

                                </div>
                            </div>
                        </div>
                        <div *ngxPermissionsOnly="['client_view_users']" class="col-sm-6 col-xl-3">
                            <div
                                class="bg-white d-flex align-items-center justify-content-between pt-2 pb-2 pl-3 pr-3 zone">

                                <div class=" ml-1 mt-1">
                                    <p class="mb-3" style="font-size: 14px; color: #202224;">Your users</p>
                                    <h3 class="mb-0" style="color: black; font-size: 2em;">{{formatNumber(users.total)}}</h3>
                                    <p class="mb-2 mt-4" style="font-size: 14px">
                                        <svg width="15" height="15" viewBox="0 0 24 24" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M16 6L18.29 8.29L13.41 13.17L9.41 9.17L2 16.59L3.41 18L9.41 12L13.41 16L19.71 9.71L22 12V6H16Z"
                                                fill="#00B69B" />
                                        </svg>
                                        <span style="color: #00B69B;margin-right: 5px;">{{formatNumber(users.active)}}</span> Active users
                                    </p>
                                </div>
                                <div class="ms-3 mb-auto">
                                    <p class="mb-2"><svg width="50" height="50" viewBox="0 0 60 60" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path opacity="0.21" fill-rule="evenodd" clip-rule="evenodd"
                                                d="M0 30V37C0 49.7025 10.2975 60 23 60H30H37C49.7025 60 60 49.7025 60 37V30V23C60 10.2975 49.7025 0 37 0H30H23C10.2975 0 0 10.2975 0 23V30Z"
                                                fill="#8280FF" />
                                            <path opacity="0.587821" fill-rule="evenodd" clip-rule="evenodd"
                                                d="M20.6666 23.3333C20.6666 26.2789 23.0544 28.6667 26 28.6667C28.9455 28.6667 31.3333 26.2789 31.3333 23.3333C31.3333 20.3878 28.9455 18 26 18C23.0544 18 20.6666 20.3878 20.6666 23.3333ZM34 28.6667C34 30.8758 35.7908 32.6667 38 32.6667C40.2091 32.6667 42 30.8758 42 28.6667C42 26.4575 40.2091 24.6667 38 24.6667C35.7908 24.6667 34 26.4575 34 28.6667Z"
                                                fill="#8280FF" />
                                            <path fill-rule="evenodd" clip-rule="evenodd"
                                                d="M25.9778 31.3335C19.6826 31.3335 14.5177 34.5689 14.0009 40.9324C13.9727 41.2791 14.6356 42.0002 14.97 42.0002H36.9956C37.9972 42.0002 38.0128 41.1941 37.9972 40.9335C37.6065 34.3911 32.3616 31.3335 25.9778 31.3335ZM45.2746 42.0002L40.1333 42.0002C40.1333 38.9989 39.1417 36.2293 37.4683 34.001C42.0103 34.0506 45.7189 36.347 45.998 41.2002C46.0092 41.3956 45.998 42.0002 45.2746 42.0002Z"
                                                fill="#8280FF" />
                                        </svg>
                                    </p>

                                </div>
                            </div>
                        </div>

                        <div *ngxPermissionsOnly="['client_status_estimation']" class="col-sm-6 col-xl-6 ">
                            <div class="zone3   align-items-center justify-content-between ">
                                <div class="d-flex fll ">
                                    <div class="ml-2" style="font-size: 14px; color: #202224;">Licence Status
                                        Estimations</div>
                                </div>

                                <div class="d-flex fll pl-4 pb-2 mt-3">
                                    <div class="">
                                        <h6 class="mb-2" style="color: #202224; ">Active</h6>
                                        <h5 class="mt-3" style="color: #00B69B; text-align: center; ">{{formatNumber(license_status.active)}}</h5>
                                    </div>
                                    <div class="" >
                                        <h6 class="mb-2" style="color: #202224;">Expired</h6>
                                        <h5 class="mt-3" style="color: #F1963A; text-align: center;">{{formatNumber(license_status.expired) }}</h5>

                                    </div>
                                    <div class="" >
                                        <h6 class="mb-2" style="color: #202224; font-size: 17px; font-weight: 500;">DNE</h6>
                                        <h5 class="mt-3" style="color: #FD5454; text-align: center; font-weight: 700 !important;">{{formatNumber(license_status.dne)}}</h5>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <!-- Sale & Revenue End -->


                    <!-- Sales Chart Start -->
                    <div class="container-fluid pt-4 px-1">
                        <div class="row g-4">
                            <div class="col-sm-12 col-xl-12">
                                <div class="bg-white  case">
                                    <div class=" p-4">
                                        <div class="d-flex flll ">
                                            <h2 class="" style="color: rgba(32, 34, 36, 1); font-size: 24px;">
                                                Verification history estimations </h2>

                                            <!-- Menu déroulant pour sélectionner le mois -->
                                            <div class="mb-3 ml-auto">
                                                <select id="monthSelect" class="select form-select ">
                                                    <option value="all" selected>All</option>
                                                    <option *ngFor="let month of months; index as i" [value]="i">{{
                                                        month }}</option>
                                                </select>
                                            </div>
                                        </div>

                                        <canvas id="myChart"></canvas>

                                    </div>

                                    <!-- JavaScript for Chart.js -->
                                </div>
                            </div>

                        </div>
                    </div>


                    <!-- Sales Chart End -->


                    <!--  Tableau Start -->


                    <div *ngxPermissionsOnly="['client_recent_verifications']" class="container-fluid pt-2 px-2 mt-3">
                        <div class="bg-white text-center p-4 case">
                            <div class="d-flex align-items-center justify-content-between mb-4">
                                <h6 class="titre-tableau mb-0">Recent Verification</h6>
                                <div class="conteneur-select ml-auto">
                                    <input type="search" class="form-control" placeholder="Search user" style="background-color: #F5F6FA; color: #202224; margin-bottom: 5px;" id="startDate" [(ngModel)]="searchTerm">
                                    <select [(ngModel)]="selectedStatus" class="form-select" aria-label="Default select example"
                                        style="background-color: #F5F6FA; color: #202224; margin-bottom: 5px;">
                                        <option *ngFor="let category of status" [value]="category">{{ category }}</option>
                                    </select>
                                    <label for="startDate">Start-date:</label>
                                    <input type="date" class="form-control" style="background-color: #F5F6FA; color: #202224; margin-bottom: 5px;" id="startDate" [(ngModel)]="startDate">
                                    
                                    <label for="endDate">End-date:</label>
                                    <input type="date" class="form-control" style="background-color: #F5F6FA; color: #202224; margin-bottom: 5px;" id="endDate" [(ngModel)]="endDate">
                                </div>

                            </div>

                            <div class=" mt-4">
                                <div class="row">
                                    <div class="col card table-responsive" style="padding: 1px;">
                                        <table class="table " style="margin-bottom: 220px;">
                                            <thead>
                                                <tr class="">
                                                    <th style="background-color: aliceblue;">Date</th>
                                                    <th style="background-color: aliceblue;">Time</th>
                                                    <th style="background-color: aliceblue;">User</th>
                                                    <th class="px-5" style="background-color: aliceblue;">Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr *ngFor="let check of filteredItems">
                                                    <td>{{check.check.check_date | date: "dd/MM/yyyy"}}</td>
                                                    <td>{{check.check.check_date | date: "hh:mm:ss"}}</td>
                                                    <td >
                                                        {{ findUser(check.check.user_id) | async }}
                                                        <img *ngIf="check.automobile !== null" src="../../assets/Box Important.png"
                                                        (click)="toggleInfo($event, check.check.id)"
                                                            style="width: 20px; margin-top: -2px;">

                                                        <div class="modale-info" *ngIf="isInfoVisible(check.check.id)">
                                                            <div
                                                                style="color: rgba(145, 142, 244, 1); text-align: center;">
                                                                More information
                                                            </div>
                                                            <div *ngIf="check.automobile !== null" class="d-flex mt-2 dep">
                                                                <div class="pl-4 results-left"
                                                                    style="font-weight: 200;">
                                                                    <span *ngIf="check.automobile.make">Automobile Make: </span> <br>
                                                                    <span class="mt-1">Model</span> <br>
                                                                    <span class="mt-1">Owner’s name  </span><br>
                                                                    <span class="mt-1">Policy number  </span><br>
                                                                    <span class="mt-2">VIN number </span><br>
                                                                    <span class="pt-5">Expiration date </span>
                                                                </div>
                                                                <div class="divider"></div>
                                                                <div>
                                                                    <h6 class="text-dark">{{check.automobile.make}} </h6>
                                                                    <h6 class="text-dark">{{check.automobile.model}} </h6>
                                                                    <h6 class="text-dark">{{check.automobile.owername}}</h6>
                                                                    <h6 class="text-dark">{{check.automobile.policyname}}</h6>
                                                                    <h6 class="text-dark"> {{check.automobile.vin}} </h6>
                                                                    <h6 class="text-dark">{{check.automobile.expiredate | date: "dd/MM/yyyy"}} </h6>
                                                                </div>
                                                            </div>
                                                            <div *ngIf="check.automobile == null" class="d-flex mt-2 dep">
                                                                No data
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td style="padding-top: 3px !important;">
                                                        <div class="container ">
                                                            <div *ngIf="check.check.status == 'insured'" class="active px-2 py-2">
                                                                <h6>Active</h6>
                                                            </div>
                                                            <div *ngIf="check.check.status == 'expired'" class="noactive px-2 py-2">
                                                                <h6>Expired</h6>
                                                            </div>
                                                            <div *ngIf="check.check.status == 'not_found'" class="noactive px-2 py-2">
                                                                <h6>Not found</h6>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                        </div>



                    </div>
                    <!-- Recent Sales End -->





                </div>



            </div>


        </main>
    </div>
</div>

<script>
    const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]')
    const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl))
</script>